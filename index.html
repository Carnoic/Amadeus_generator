<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Amadeus Bokningsgenerator</title>
  <style>
    body { font-family: sans-serif; max-width: 1000px; margin: auto; padding: 20px; }
    input, select, textarea { width: 100%; margin-bottom: 10px; padding: 8px; }
    button { padding: 10px 20px; }
    .passenger-box { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    .ssr-tag { background: #eee; margin: 2px; padding: 4px 8px; display: inline-block; cursor: pointer; border-radius: 4px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/airport-autocomplete-js@latest/dist/index.browser.min.js"></script>
</head>
<body>
  <h1>Amadeus Bokningsgenerator</h1>

  <label>Antal resenärer:</label>
  <input type="number" id="numPassengers" min="1" value="1" onchange="renderPassengerFields()">

  <div id="passengerFields"></div>

  <label>Avresedatum (DDMMM):</label>
  <input type="text" id="date" placeholder="t.ex. 17JUL">

  <label>Från (flygplats/stad):</label>
  <input type="text" id="from">

  <label>Till (flygplats/stad):</label>
  <input type="text" id="to">

  <label>Kontakt (telefon):</label>
  <input type="text" id="contactPhone" placeholder="t.ex. +46701234567">

  <label>Kontakt (e-post):</label>
  <input type="text" id="contactEmail" placeholder="t.ex. test@example.com">

  <label>Giltighet för biljett (TKTL):</label>
  <input type="text" id="tktlDate" placeholder="t.ex. 25JUN">

  <h2>Special Service Requests (SSR)</h2>
  <select id="ssrDropdown">
    <option value="">-- Välj SSR --</option>
    <optgroup label="Måltider">
      <option value="SRAVML">AVML - Asian Vegetarian Meal</option>
      <option value="SRVGML">VGML - Vegetarian Vegan Meal</option>
      <option value="SRVLML">VLML - Vegetarian Lacto-Ovo Meal</option>
      <option value="SRHNML">HNML - Hindu Non-Vegetarian Meal</option>
      <option value="SRKSML">KSML - Kosher Meal</option>
      <option value="SRMOML">MOML - Muslim Meal</option>
      <option value="SRCHML">CHML - Child Meal</option>
      <option value="SRBBML">BBML - Baby Meal</option>
      <option value="SRDBML">DIABML - Diabetic Meal</option>
      <option value="SRGFML">GFML - Gluten Free Meal</option>
      <option value="SRLCML">LCML - Low Calorie Meal</option>
      <option value="SRLFML">LFML - Low Fat Meal</option>
      <option value="SRLSML">LSML - Low Sodium Meal</option>
      <option value="SRNLML">NLML - Non-Lactose Meal</option>
      <option value="SRBLML">BLML - Bland Meal</option>
      <option value="SRSFML">SFML - Seafood Meal</option>
      <option value="SRFPML">FPML - Fruit Platter</option>
    </optgroup>
    <optgroup label="Assistans">
      <option value="SRWCHR">WCHR - Wheelchair (Ramp)</option>
      <option value="SRWCHC">WCHC - Wheelchair (Cabin seat)</option>
      <option value="SRWCHS">WCHS - Wheelchair (Steps)</option>
      <option value="SRBLND">BLND - Blind Passenger</option>
      <option value="SRDEAF">DEAF - Deaf Passenger</option>
      <option value="SRDPNA">DPNA - Intellectual Disability</option>
      <option value="SRMAAS">MAAS - Meet and Assist</option>
      <option value="SRUMNR">UMNR - Unaccompanied Minor</option>
    </optgroup>
    <optgroup label="Sittplats">
      <option value="SRSEAT">SEAT - Seat Request</option>
      <option value="SREXST">EXST - Extra Seat</option>
      <option value="SRBULK">BULK - Bulkhead Seat</option>
      <option value="SRNSSB">NSSB - No Smoking Bulkhead</option>
      <option value="SRNSSA">NSSA - No Smoking Aisle</option>
      <option value="SRNSSW">NSSW - No Smoking Window</option>
    </optgroup>
    <optgroup label="Bagage">
      <option value="SRXBAG">XBAG - Extra Baggage</option>
      <option value="SRBBAG">BBAG - Bicycle as Baggage</option>
      <option value="SRGOLF">GOLF - Golf Equipment</option>
      <option value="SRSKIS">SKIS - Ski Equipment</option>
      <option value="SRSURF">SURF - Surfboard</option>
      <option value="SRBIKE">BIKE - Bicycle</option>
    </optgroup>
    <optgroup label="Övrigt">
      <option value="SRDOCS">DOCS - Travel Documents</option>
      <option value="SRDOCA">DOCA - Destination Address</option>
      <option value="SRDOCO">DOCO - Other Travel Documents</option>
      <option value="SRCTCM">CTCM - Contact Mobile</option>
      <option value="SRCTCE">CTCE - Contact Email</option>
      <option value="SRCTCH">CTCH - Contact Home</option>
      <option value="SRCTCB">CTCB - Contact Business</option>
      <option value="SROTHS">OTHS - Other Service Info</option>
      <option value="SRLANG">LANG - Language Preference</option>
      <option value="SRPETC">PETC - Pet in Cabin</option>
      <option value="SRAVIH">AVIH - Animal in Hold</option>
    </optgroup>
  </select>
  <button onclick="addSSR()">Lägg till</button>
  <div id="ssrList"></div>

  <button onclick="generate()">Generera Amadeus-kod</button>

  <h2>Genererad Amadeus-kod</h2>
  <textarea id="output" rows="15" readonly></textarea>

  <script>
    const ssrSet = new Set();

    function renderPassengerFields() {
      const num = parseInt(document.getElementById('numPassengers').value);
      const container = document.getElementById('passengerFields');
      container.innerHTML = '';

      for (let i = 0; i < num; i++) {
        const box = document.createElement('div');
        box.className = 'passenger-box';
        box.innerHTML = `
          <label>Resenär ${i + 1} namn (EFTERNAMN/FÖRNAMN):</label>
          <input type="text" id="name_${i}" placeholder="ERIKSSON/JOHAN">
          <label>Titel:</label>
          <select id="title_${i}">
            <option value="MR">MR</option>
            <option value="MRS">MRS</option>
            <option value="MISS">MISS</option>
            <option value="CHD">CHD (barn)</option>
            <option value="INF">INF (spädbarn)</option>
          </select>
        `;
        container.appendChild(box);
      }
    }

    function addSSR() {
      const ssr = document.getElementById("ssrDropdown").value;
      if (ssr && !ssrSet.has(ssr)) {
        ssrSet.add(ssr);
        const tag = document.createElement("span");
        tag.className = "ssr-tag";
        tag.textContent = ssr + ' ✕';
        tag.onclick = () => {
          ssrSet.delete(ssr);
          tag.remove();
        };
        document.getElementById("ssrList").appendChild(tag);
      }
    }

    function generate() {
      try {
        const date = document.getElementById("date").value.trim().toUpperCase();
        const fromInput = document.getElementById("from");
        const toInput = document.getElementById("to");

        const from = fromInput.dataset.iata;
        const to = toInput.dataset.iata;

        if (!from || !to) throw new Error("Välj avreseort och destination från listan så att IATA-kod inkluderas.");

        const phone = document.getElementById("contactPhone").value.trim();
        const email = document.getElementById("contactEmail").value.trim();
        const tktl = document.getElementById("tktlDate").value.trim().toUpperCase();
        const num = parseInt(document.getElementById('numPassengers').value);

        let output = `AN${date}${from}${to}\n`;

        for (let i = 0; i < num; i++) {
          const name = document.getElementById(`name_${i}`).value.trim().toUpperCase();
          const title = document.getElementById(`title_${i}`).value.trim().toUpperCase();
          output += `NM1${name}${title}\n`;
        }

        ssrSet.forEach(ssr => output += ssr + "\n");
        if (phone) output += `AP${phone}\n`;
        if (email) output += `APE-${email}\n`;
        output += `TKTL/${tktl || 'DAGENS_DATUM'}\n`;
        output += "ER\n";

        document.getElementById("output").value = output;
      } catch (e) {
        document.getElementById("output").value = "Kunde inte generera kod: " + e.message;
      }
    }

    renderPassengerFields();

    window.addEventListener('DOMContentLoaded', () => {
      const fromInput = document.getElementById('from');
      const toInput = document.getElementById('to');

      AirportInput(fromInput, {
        placeholder: 'Skriv stad eller IATA…',
        fuse_options: {
          threshold: 0.3,
          keys: [
            { name: 'iata', weight: 0.5 },
            { name: 'city', weight: 0.3 },
            { name: 'name', weight: 0.2 }
          ]
        },
        onSelect: (selected) => {
          fromInput.dataset.iata = selected.iata;
        }
      });

      AirportInput(toInput, {
        placeholder: 'Skriv stad eller IATA…',
        fuse_options: {
          threshold: 0.3,
          keys: [
            { name: 'iata', weight: 0.5 },
            { name: 'city', weight: 0.3 },
            { name: 'name', weight: 0.2 }
          ]
        },
        onSelect: (selected) => {
          toInput.dataset.iata = selected.iata;
        }
      });
    });
  </script>
</body>
</html>
